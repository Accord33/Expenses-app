# プロジェクト構成ドキュメント

## プロジェクト概要
**スマホDe家計簿** - スマートフォンの支払い画面のスクリーンショットから自動で家計簿を作成するアプリケーション

---

## ディレクトリ構成

```
expenses/                                    # プロジェクトルート
│
├── README.md                                # プロジェクト説明（現在は空）
├── 要件定義.md                              # プロジェクトの要件定義書
├── ファイル構成.md                          # 本ドキュメント
├── pyproject.toml                           # プロジェクト全体の設定ファイル
│
├── app/                                     # メインアプリケーションディレクトリ
│   ├── pyproject.toml                       # Fletアプリの設定ファイル（依存関係、ビルド設定）
│   ├── .gitignore                           # Git除外設定
│   │
│   ├── src/                                 # ソースコードディレクトリ
│   │   ├── main.py                          # アプリケーションエントリーポイント、ルーティング制御
│   │   ├── config.py                        # アプリケーション設定管理（環境変数、パス設定）
│   │   │
│   │   ├── assets/                          # 静的リソース格納ディレクトリ
│   │   │   ├── icon.png                     # アプリアイコン
│   │   │   └── splash_android.png           # Android用スプラッシュ画像
│   │   │
│   │   ├── components/                      # 再利用可能なUIコンポーネント
│   │   │   ├── __init__.py                  # パッケージ初期化
│   │   │   ├── navigation.py                # ナビゲーションバーコンポーネント
│   │   │   ├── image_upload.py              # 画像アップロード機能（temp→pic移動処理）
│   │   │   └── gemini-ptt.py                # Gemini API連携（画像からデータ抽出）
│   │   │
│   │   ├── utils/                           # ユーティリティ関数群
│   │   │   ├── __init__.py                  # パッケージ初期化
│   │   │   └── storage.py                   # ストレージパス管理（ディレクトリ構造の抽象化）
│   │   │
│   │   └── views/                           # 画面ビュー定義ディレクトリ
│   │       ├── __init__.py                  # パッケージ初期化
│   │       ├── view1.py                     # 入力画面（家計簿データ入力・画像アップロード）
│   │       ├── view2.py                     # レポート画面（支出レポート・円グラフ表示）
│   │       ├── view3.py                     # ブックマーク画面（お気に入り機能）
│   │       └── category_detail.py           # カテゴリ詳細画面（カテゴリ別支出グラフ）
│   │
│   └── storage/                             # データ永続化ディレクトリ
│       ├── data/                            # 構造化データ保存（JSON、DBなど）
│       ├── pic/                             # アップロードされた画像の最終保存先
│       └── temp/                            # 一時ファイル保存（アップロード中間処理用）
│
└── memo/                                    # テスト・開発用スクリプト
    ├── gemini-ptt.py                        # Gemini API動作確認用テストスクリプト
    ├── main0.py                             # 初期バージョンのメイン（アーカイブ）
    ├── main copy.py                         # メインファイルのバックアップ
    └── view1 copy.py                        # view1のバックアップ
```

---

## 各ディレクトリの役割詳細

### 📁 `app/src/`
アプリケーションのメインソースコード。すべてのビジネスロジックとUI定義を含む。

### 📁 `app/src/components/`
**再利用可能なUIコンポーネントを集約**
- 複数の画面で共通して使用されるUI部品
- 独立した機能単位でカプセル化
- 保守性と再利用性の向上を目的とする

### 📁 `app/src/utils/`
**汎用的なヘルパー関数・ユーティリティクラス**
- ビジネスロジックに依存しない共通処理
- パス管理、データ変換などの補助機能
- テストしやすい純粋関数を推奨

### 📁 `app/src/views/`
**画面単位のビュー定義**
- 各画面は独立したファイルで管理
- ルーティングと対応（`/view1` → `view1.py`）
- UIレイアウトとイベントハンドラを含む

### 📁 `app/storage/`
**実行時に生成されるデータの保存場所**
- `data/`: アプリケーションデータ（将来的にJSONやSQLiteなど）
- `pic/`: ユーザーがアップロードした画像の保存先
- `temp/`: アップロード処理の一時ファイル（処理後は`pic/`に移動）

### 📁 `memo/`
**開発中のテストコードとバックアップ**
- 本番コードには含まれない
- API動作確認、プロトタイプ、旧バージョンの保管場所

---

## 主要ファイルの機能説明

### `app/src/main.py`
**役割**: アプリケーションのエントリーポイント
- Fletアプリケーションの起動
- ルーティング制御（URL → ビューのマッピング）
- ページ遷移の管理

### `app/src/config.py`
**役割**: アプリケーション設定の一元管理
- 環境変数の読み込み（`.env`対応）
- ストレージディレクトリパスの提供
- シークレットキー管理

### `app/src/components/navigation.py`
**役割**: 画面下部のナビゲーションバー
- 入力画面 / レポート画面 / ブックマーク画面への遷移
- 共通UIコンポーネント

### `app/src/components/image_upload.py`
**役割**: 画像アップロード処理
- ファイル選択UI（FilePicker）の提供
- アップロード完了後の処理（temp → pic へ移動）
- タイムスタンプ付きファイル名生成

### `app/src/components/gemini-ptt.py`
**役割**: Gemini AI による画像解析
- スクリーンショットから金額・日付・分類を抽出
- JSON形式でデータを返却
- PayPay等の支払い画面に対応

### `app/src/utils/storage.py`
**役割**: ストレージパス管理
- 実行環境に依存しないパス取得
- ディレクトリの自動生成
- パス操作の抽象化

### `app/src/views/view1.py`
**役割**: メイン入力画面
- カテゴリ選択ボタン（食費、交通費、娯楽費、日用品）
- 画像アップロード機能
- 家計簿データの入力UI

### `app/src/views/view2.py`
**役割**: レポート表示画面
- 支出の可視化（円グラフ）
- カテゴリ別サマリー表示
- カテゴリ詳細画面への遷移

### `app/src/views/view3.py`
**役割**: ブックマーク画面
- よく使う機能へのショートカット（将来実装予定）

### `app/src/views/category_detail.py`
**役割**: カテゴリ別詳細画面
- カテゴリごとの詳細な支出グラフ（棒グラフ）
- パラメータ付きルーティング（`/category_detail?category=食費`）

---

## 開発フロー

1. **画面追加**: `app/src/views/` に新しいビューファイルを作成
2. **コンポーネント追加**: `app/src/components/` に再利用可能なUI部品を追加
3. **ユーティリティ追加**: `app/src/utils/` に共通ロジックを追加
4. **ルーティング設定**: `main.py` の `route_change` 関数に新しいルートを追加
5. **データ保存**: `storage/data/` 配下にJSON等のデータファイルを配置

---

## 技術スタック

- **フレームワーク**: Flet (Python製UIフレームワーク)
- **AI/ML**: Google Gemini API（画像認識・データ抽出）
- **画像処理**: Pillow（将来的な画像最適化用）
- **データ管理**: ファイルベース（将来的にSQLite導入検討）

---

## 注意事項

- `storage/` 配下のディレクトリは自動生成される（手動作成不要）
- `memo/` ディレクトリのファイルは本番環境に含めない
- 環境変数は `.env` ファイルで管理（`FLET_SECRET_KEY` など）
- 画像ファイルは `storage/pic/` に永続的に保存される

---

**最終更新日**: 2025年10月29日
